@page "/products"
@using PPTWebApp.Data.Models
@using PPTWebApp.Data.Services
@inject ProductService ProductService
@rendermode InteractiveServer

@code {
    private List<Product> Products;
    private int maxProductsToDisplay = 8;
    private int pageIndex = 0;
    private int totalProducts = 0;
    private int totalPages = 1;

    protected override async Task OnInitializedAsync()
    {
        totalProducts = ProductService.GetTotalProductCount();
        totalPages = (int)Math.Ceiling((double)totalProducts / maxProductsToDisplay);

        LoadProducts();
    }

    private void LoadProducts()
    {
        Products = ProductService.GetProductsInRange(pageIndex * maxProductsToDisplay, maxProductsToDisplay).ToList();
        int placeholdersNeeded = maxProductsToDisplay - Products.Count;
        for (int i = 0; i < placeholdersNeeded; i++)
        {
            Products.Add(null);
        }
    }

    private void LoadNextPage()
    {
        if (pageIndex < totalPages - 1)
        {
            pageIndex++;
            LoadProducts();
        }
    }

    private void LoadPreviousPage()
    {
        if (pageIndex > 0)
        {
            pageIndex--;
            LoadProducts();
        }
    }

    private void OnPageInputChange(ChangeEventArgs e)
    {
        int inputPage = Math.Max(1, Math.Min(totalPages, int.Parse(e.Value.ToString())));
        pageIndex = inputPage - 1;
        LoadProducts();
    }
}


<div class="product-grid-container">
    <div class="query-bar-container">
        <button class="btn btn-dark d-lg-none mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#queryBar" aria-expanded="false" aria-controls="queryBar">
            Filters
        </button>

        <div id="queryBar" class="query-bar collapse d-lg-block">
            <div class="row gx-3">
                <div class="col-md-2 mb-2">
                    <input type="text" placeholder="Search products..." class="form-control" />
                </div>

                <div class="col-md-2 mb-2">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Sort By
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                            <li><a class="dropdown-item" href="#">Best Sellers</a></li>
                            <li><a class="dropdown-item" href="#">Cheapest First</a></li>
                            <li><a class="dropdown-item" href="#">Most Expensive First</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 mb-2 d-flex align-items-center">
                    <label for="priceRange" class="me-2">Price Range:</label>
                    <input type="number" id="minPriceInput" min="0" max="1000" value="0" class="form-control w-25" />
                    <span class="mx-2">to</span>
                    <input type="number" id="maxPriceInput" min="0" max="1000" value="1000" class="form-control w-25" />
                </div>

                <div class="col-md-2 mb-2">
                    <select class="form-select">
                        <option value="all">All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="fashion">Fashion</option>
                        <option value="home-appliances">Home Appliances</option>
                    </select>
                </div>

                <div class="col-md-2 mb-2">
                    <select class="form-select">
                        <option value="all">All Brands</option>
                        <option value="brand-a">Brand A</option>
                        <option value="brand-b">Brand B</option>
                        <option value="brand-c">Brand C</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="row gx-3 gy-3 align-items-stretch">
        @foreach (var product in Products)
        {
            <div class="col-12 col-md-6 col-lg-3">
                <div class="product-box">
                    <ProductPreview Product="@product" />
                </div>
            </div>
        }
    </div>

    <div class="pagination">
        <button class="pagination-btn" @onclick="LoadPreviousPage" >←</button>
        <input type="number" value="@(pageIndex + 1)" min="1" max="@totalPages" class="page-input" @onchange="OnPageInputChange" />
        of page: <span class="total-pages"> @totalPages</span>
        <button class="pagination-btn" @onclick="LoadNextPage" >→</button>
    </div>
</div>
